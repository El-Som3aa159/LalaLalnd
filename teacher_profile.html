<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… - LalaLand</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="CSS/dashboard_style.css">
    <style>
        .teacher-profile-container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
        }

        .teacher-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .teacher-avatar {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .teacher-header h1 {
            margin: 20px 0 10px;
            font-size: 2.5rem;
        }

        .teacher-header .specialization {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .teacher-bio-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .teacher-bio-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .teacher-bio-content {
            line-height: 1.8;
            color: #636e72;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .teacher-bio-empty {
            color: #b2bec3;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-right: 4px solid #dfe6e9;
        }

        .teacher-courses-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .teacher-courses-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .course-card-mini {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .course-card-mini:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .course-card-mini h3 {
            margin: 0 0 10px;
            color: #2d3436;
        }

        .course-card-mini p {
            margin: 0;
            color: #636e72;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #5568d3;
        }

        body.dark-mode .teacher-bio-section,
        body.dark-mode .teacher-courses-section {
            background: var(--card-bg);
            color: var(--text-color);
        }

        body.dark-mode .teacher-bio-content {
            color: #ddd;
        }

        body.dark-mode .course-card-mini {
            background: #404058;
        }

        body.dark-mode .course-card-mini h3 {
            color: white;
        }

        body.dark-mode .course-card-mini p {
            color: #aaa;
        }

        .course-card-mini.purchased {
            border-right-color: #00b894;
            background: #f0fff4;
        }

        body.dark-mode .course-card-mini.purchased {
            background: #1a3a2a;
            border-right-color: #00b894;
        }

        .course-card-mini.purchased::after {
            content: 'âœ… Ù…Ø´ØªØ±ÙŠ';
            display: block;
            font-size: 0.85rem;
            color: #00b894;
            font-weight: bold;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #ddd;
        }

        body.dark-mode .course-card-mini.purchased::after {
            border-top-color: #444;
        }
            text-align: center;
            padding: 40px;
            color: #636e72;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="teacher-profile-container">
        <a href="javascript:history.back()" class="back-button">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
        
        <div id="teacherProfile">
            <div id="loadingMessage">
                <div class="loading-spinner"></div>
                Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
            </div>
        </div>
    </div>

    <script src="JS/theme.js"></script>
    <script>
        // Shared Notification Function
        function showNotification(message, type = 'success') {
            let container = document.getElementById('notification-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notification-container';
                container.style.cssText = "position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; width: 300px;";
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.textContent = message;
            const bgColor = type === 'error' ? '#d63031' : '#00b894';
            toast.style.cssText = `background-color: ${bgColor}; color: white; padding: 15px; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; font-family: 'Cairo', sans-serif; opacity: 0; transition: opacity 0.5s ease;`;
            
            container.appendChild(toast);
            
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
            });

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 3000);
        }

        // Check if user is logged in before accessing course
        function viewCourse(courseId) {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            
            if (!currentUser) {
                showNotification('ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒÙˆØ±Ø³.', 'error');
                return;
            }
            
            // User is logged in, proceed to course
            window.location.href = `course_details.html?id=${courseId}`;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const teacherId = urlParams.get('teacher_id');

            if (!teacherId) {
                document.getElementById('teacherProfile').innerHTML = '<p style="text-align: center; color: #d63031;">âŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ù„Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>';
                return;
            }

            try {
                // Get current user to check enrollments
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                let enrolledCourseIds = [];
                
                if (currentUser && currentUser.id) {
                    try {
                        const enrollmentResponse = await fetch(`PHP/enrollments.php?action=list&student_id=${currentUser.id}`);
                        const enrollmentData = await enrollmentResponse.json();
                        if (enrollmentData.success && enrollmentData.data) {
                            enrolledCourseIds = enrollmentData.data.map(e => e.id);
                        }
                    } catch (e) {
                        console.error('Error checking enrollments:', e);
                    }
                }

                // Fetch teacher data
                const response = await fetch(`PHP/courses.php?action=get_teacher&teacher_id=${teacherId}`);
                const result = await response.json();

                if (result.success && result.data) {
                    const teacher = result.data;
                    const courses = teacher.courses || [];

                    let html = `
                        <div class="teacher-header">
                            <div class="teacher-avatar">ğŸ‘¨â€ğŸ«</div>
                            <h1>${teacher.full_name || 'Ù…Ø¹Ù„Ù…'}</h1>
                            <div class="specialization">${teacher.specialization || 'Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…'}</div>
                        </div>

                        <div class="teacher-bio-section">
                            <h2>ğŸ“ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</h2>
                            <div class="teacher-bio-content">
                                ${teacher.bio ? teacher.bio : '<div class="teacher-bio-empty">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø¨Ø¹Ø¯</div>'}
                            </div>
                        </div>
                    `;

                    if (courses.length > 0) {
                        html += `
                            <div class="teacher-courses-section">
                                <h2>ğŸ“š Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                                <div class="courses-grid">
                        `;

                        courses.forEach(course => {
                            const isPurchased = enrolledCourseIds.includes(course.id);
                            const purchasedClass = isPurchased ? 'purchased' : '';
                            html += `
                                <div class="course-card-mini ${purchasedClass}" onclick="viewCourse(${course.id})">
                                    <h3>${course.title}</h3>
                                    <p>${course.subtitle || 'ÙƒÙˆØ±Ø³ Ù…ØªÙ…ÙŠØ²'}</p>
                                    <p style="margin-top: 10px; color: #667eea; font-weight: bold;">
                                        ${course.price > 0 ? course.price + ' Ø¬.Ù…' : 'Ù…Ø¬Ø§Ù†ÙŠ'}
                                    </p>
                                </div>
                            `;
                        });

                        html += `
                                </div>
                            </div>
                        `;
                    }

                    document.getElementById('teacherProfile').innerHTML = html;
                } else {
                    document.getElementById('teacherProfile').innerHTML = '<p style="text-align: center; color: #d63031;">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('teacherProfile').innerHTML = '<p style="text-align: center; color: #d63031;">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…</p>';
            }
        });
    </script>
</body>
</html>
